!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.MidiConvert=t():e.MidiConvert=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var a=r[n]={exports:{},id:n,loaded:!1};return e[n].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){var n,a;n=[r(1),r(2),r(3)],a=function(e,t,r){return{parse:function(n){var a=e(n),o=t(a);return{transport:o,tracks:r(a,o)}},load:function(e,t){var r=new XMLHttpRequest;return r.open("GET",e),r.overrideMimeType("text/plain; charset=x-user-defined"),r.onload=function(){if(4===r.readyState&&200===r.status){for(var e=r.responseText||"",n=[],a=0;a<e.length;a++)n[a]=String.fromCharCode(255&e.charCodeAt(a));var o=this.parse(n.join(""));t&&t(o)}}.bind(this),r.send(),r}}}.apply(t,n),!(void 0!==a&&(e.exports=a))},function(e,t){function r(e){function t(e){var t=e.read(4),r=e.readInt32();return{id:t,length:r,data:e.read(r)}}function r(e){var t={};t.deltaTime=e.readVarInt();var r=e.readInt8();if(240==(240&r)){if(255==r){t.type="meta";var n=e.readInt8(),o=e.readVarInt();switch(n){case 0:if(t.subtype="sequenceNumber",2!=o)throw"Expected length for sequenceNumber event is 2, got "+o;return t.number=e.readInt16(),t;case 1:return t.subtype="text",t.text=e.read(o),t;case 2:return t.subtype="copyrightNotice",t.text=e.read(o),t;case 3:return t.subtype="trackName",t.text=e.read(o),t;case 4:return t.subtype="instrumentName",t.text=e.read(o),t;case 5:return t.subtype="lyrics",t.text=e.read(o),t;case 6:return t.subtype="marker",t.text=e.read(o),t;case 7:return t.subtype="cuePoint",t.text=e.read(o),t;case 32:if(t.subtype="midiChannelPrefix",1!=o)throw"Expected length for midiChannelPrefix event is 1, got "+o;return t.channel=e.readInt8(),t;case 47:if(t.subtype="endOfTrack",0!=o)throw"Expected length for endOfTrack event is 0, got "+o;return t;case 81:if(t.subtype="setTempo",3!=o)throw"Expected length for setTempo event is 3, got "+o;return t.microsecondsPerBeat=(e.readInt8()<<16)+(e.readInt8()<<8)+e.readInt8(),t;case 84:if(t.subtype="smpteOffset",5!=o)throw"Expected length for smpteOffset event is 5, got "+o;var i=e.readInt8();return t.frameRate={0:24,32:25,64:29,96:30}[96&i],t.hour=31&i,t.min=e.readInt8(),t.sec=e.readInt8(),t.frame=e.readInt8(),t.subframe=e.readInt8(),t;case 88:if(t.subtype="timeSignature",4!=o)throw"Expected length for timeSignature event is 4, got "+o;return t.numerator=e.readInt8(),t.denominator=Math.pow(2,e.readInt8()),t.metronome=e.readInt8(),t.thirtyseconds=e.readInt8(),t;case 89:if(t.subtype="keySignature",2!=o)throw"Expected length for keySignature event is 2, got "+o;return t.key=e.readInt8(!0),t.scale=e.readInt8(),t;case 127:return t.subtype="sequencerSpecific",t.data=e.read(o),t;default:return t.subtype="unknown",t.data=e.read(o),t}return t.data=e.read(o),t}if(240==r){t.type="sysEx";var o=e.readVarInt();return t.data=e.read(o),t}if(247==r){t.type="dividedSysEx";var o=e.readVarInt();return t.data=e.read(o),t}throw"Unrecognised MIDI event type byte: "+r}var u;0==(128&r)?(u=r,r=a):(u=e.readInt8(),a=r);var c=r>>4;switch(t.channel=15&r,t.type="channel",c){case 8:return t.subtype="noteOff",t.noteNumber=u,t.velocity=e.readInt8(),t;case 9:return t.noteNumber=u,t.velocity=e.readInt8(),0==t.velocity?t.subtype="noteOff":t.subtype="noteOn",t;case 10:return t.subtype="noteAftertouch",t.noteNumber=u,t.amount=e.readInt8(),t;case 11:return t.subtype="controller",t.controllerType=u,t.value=e.readInt8(),t;case 12:return t.subtype="programChange",t.programNumber=u,t;case 13:return t.subtype="channelAftertouch",t.amount=u,t;case 14:return t.subtype="pitchBend",t.value=u+(e.readInt8()<<7),t;default:throw"Unrecognised MIDI event type: "+c}}var a;stream=n(e);var o=t(stream);if("MThd"!=o.id||6!=o.length)throw"Bad .mid file - header not found";var i=n(o.data),u=i.readInt16(),c=i.readInt16(),s=i.readInt16();if(32768&s)throw"Expressing time division in SMTPE frames is not supported yet";ticksPerBeat=s;for(var d={formatType:u,trackCount:c,ticksPerBeat:ticksPerBeat},f=[],p=0;p<d.trackCount;p++){f[p]=[];var m=t(stream);if("MTrk"!=m.id)throw"Unexpected chunk - expected MTrk, got "+m.id;for(var v=n(m.data);!v.eof();){var l=r(v);f[p].push(l)}}return{header:d,tracks:f}}function n(e){function t(t){var r=e.substr(u,t);return u+=t,r}function r(){var t=(e.charCodeAt(u)<<24)+(e.charCodeAt(u+1)<<16)+(e.charCodeAt(u+2)<<8)+e.charCodeAt(u+3);return u+=4,t}function n(){var t=(e.charCodeAt(u)<<8)+e.charCodeAt(u+1);return u+=2,t}function a(t){var r=e.charCodeAt(u);return t&&r>127&&(r-=256),u+=1,r}function o(){return u>=e.length}function i(){for(var e=0;;){var t=a();if(!(128&t))return e+t;e+=127&t,e<<=7}}var u=0;return{eof:o,read:t,readInt32:r,readInt16:n,readInt8:a,readVarInt:i}}e.exports=function(e){return r(e)}},function(e,t,r){var n;n=function(){return function(e){for(var t={midiPPQ:e.header.ticksPerBeat},r=0;r<e.tracks.length;r++)for(var n=e.tracks[r],a=0;a<n.length;a++){var o=n[a];"meta"===o.type&&("timeSignature"===o.subtype?t.timeSignature=[o.numerator,o.denominator]:"setTempo"===o.subtype&&(t.bpm||(t.bpm=6e7/o.microsecondsPerBeat)))}return t.bpm=t.bpm||120,t}}.call(t,r,t,e),!(void 0!==n&&(e.exports=n))},function(e,t,r){var n,a;n=[r(4),r(5),r(6),r(7)],a=function(e,t,r,n){function a(e,a){var o=n(e,a),i={},u=t(e);u&&(i.name=u);var c=r(e,a);c&&(i.notes=c[0],i.noteOffs=c[1]);for(var s in o)i[s]=o[s];return i}return function(t,r){for(var n=(t.header.ticksPerBeat,[]),o=0;o<t.tracks.length;o++){var i=t.tracks[o];i=e.absoluteTime(i,r),n.push(a(i,r))}return n}}.apply(t,n),!(void 0!==a&&(e.exports=a))},function(e,t,r){var n;n=function(){return{midiToFloat:function(e){return parseFloat((e/127).toFixed(4))},ticksToTime:function(e,t){var r=60/t.bpm*(e/t.midiPPQ);return r},absoluteTime:function(e,t){for(var r=0,n=0;n<e.length;n++){var a=e[n];r+=a.deltaTime,a.time=this.ticksToTime(r,t),a.ticks=r,delete a.deltaTime}return e},defaults:function(e,t){e=e||{};for(var r in t)"undefined"==typeof e[r]&&(e[r]=t[r]);return e}}}.call(t,r,t,e),!(void 0!==n&&(e.exports=n))},function(e,t,r){var n;n=function(){return function(e){var t;return e.forEach(function(e){"meta"===e.type&&"trackName"===e.subtype&&(t=e.text,t=t.replace(/\u0000/g,""))}),t}}.call(t,r,t,e),!(void 0!==n&&(e.exports=n))},function(e,t,r){var n,a;n=[r(4)],a=function(e){function t(e){var t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],r=Math.floor(e/12)-1,n=e%12;return t[n]+r}return function(r){for(var n=[],a=[],o=0;o<r.length;o++){var i=r[o];if("noteOn"===i.subtype){var u={ticks:i.ticks,time:i.time,midi:i.noteNumber,noteNumber:i.noteNumber,note:t(i.noteNumber),velocity:e.midiToFloat(i.velocity)};n.push(u)}else if("noteOff"===i.subtype){a.push({ticks:i.ticks,time:i.time,midi:i.noteNumber,note:t(i.noteNumber)});for(var c=0;c<n.length;c++){var s=n[c];if(s.noteNumber===i.noteNumber&&"undefined"==typeof s.duration){s.duration=i.time-s.time,delete s.noteNumber;break}}}}return n.length?[n,a]:void 0}}.apply(t,n),!(void 0!==a&&(e.exports=a))},function(e,t,r){var n,a;n=[r(4)],a=function(e){function t(e){var t={};return e.forEach(function(e){"controller"===e.subtype&&(t[e.controllerType]=1)}),t}function r(t,r){var n=[];return t.forEach(function(t){"controller"===t.subtype&&t.controllerType===r&&n.push({ticks:t.ticks,time:t.time,value:e.midiToFloat(t.value)})}),n}var n={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoContro"};return function(e){var a=t(e),o={};for(var i in a){i=parseInt(i);var u=r(e,i);n[i]&&(o[n[i]]=u),o["cc_"+i]=u}return o}}.apply(t,n),!(void 0!==a&&(e.exports=a))}])});